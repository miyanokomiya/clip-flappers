parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"vCxL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=i,exports.__awaiter=c,exports.__generator=u,exports.__exportStar=l,exports.__values=s,exports.__read=p,exports.__spread=y,exports.__spreadArrays=_,exports.__await=b,exports.__asyncGenerator=h,exports.__asyncDelegator=d,exports.__asyncValues=v,exports.__makeTemplateObject=w,exports.__importStar=m,exports.__importDefault=O,exports.__classPrivateFieldGet=g,exports.__classPrivateFieldSet=j,exports.__createBinding=exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function a(t,e){return function(r,n){e(r,n,t)}}function i(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{u(n.next(t))}catch(e){a(e)}}function c(t){try{u(n.throw(t))}catch(e){a(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,c)}u((n=n.apply(t,e||[])).next())})}function u(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(c){a=[6,c],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}exports.__assign=r;var f=Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]};function l(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||f(e,t,r)}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,c=a.length;i<c;i++,o++)n[o]=a[i];return n}function b(t){return this instanceof b?(this.v=t,this):new b(t)}function h(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||c(t,e)})})}function c(t,e){try{(r=o[t](e)).value instanceof b?Promise.resolve(r.value.v).then(u,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function u(t){c("next",t)}function f(t){c("throw",t)}function l(t,e){t(e),a.shift(),a.length&&c(a[0][0],a[0][1])}}function d(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:b(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function v(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof s?s(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}exports.__createBinding=f;var x=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&f(e,t,r);return x(e,t),e}function O(t){return t&&t.__esModule?t:{default:t}}function g(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function j(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}
},{}],"qDjK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.base64ToImage=v,exports.clipImage=p,exports.clipImageToBlob=m,exports.drawRectOnImage=x,exports.fileToBase64=g,exports.getCentralizedViewBox=r,exports.getPagePosition=s,exports.getPointInTarget=c,exports.getRate=t,exports.getTouchPointsInTarget=h,exports.getViewBoxMargin=o,exports.getViewBoxSize=n,exports.isMulitTouch=a,exports.isTouch=i,exports.isTouchExist=u,exports.useDrag=w,exports.useWindowPointerEffect=d;var e=require("tslib");function t(e,t){if(!t)return{minRate:1,maxRate:1,rateW:1,rateH:1};var n=t.width/e.width,o=t.height/e.height;return{minRate:Math.min(n,o),maxRate:Math.max(n,o),rateW:n,rateH:o}}function n(e,t,n){return e?t>n?{width:e.width,height:e.height/n*t}:{width:e.width/t*n,height:e.height}:{width:1,height:1}}function o(e,t){return t?{x:(e.width-t.width)/2,y:(e.height-t.height)/2}:{x:0,y:0}}function r(r,i){if(!i)return(0,e.__assign)((0,e.__assign)({},r),{x:0,y:0});var a=t(r,i),u=n(i,a.rateW,a.rateH),s=o(u,i);return(0,e.__assign)({x:-s.x,y:-s.y},u)}function i(e){return"touches"in e}function a(e){return i(e)&&e.touches.length>1}function u(e){return i(e)&&e.touches.length>0}function s(e){return i(e)?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:e.pageX,y:e.pageY}}function c(e){var t,n,o=e.currentTarget;if(!o)return{x:0,y:0};var r=o.getBoundingClientRect(),a=r.left+window.pageXOffset,u=r.top+window.pageYOffset;if(i(e)){var s=e.touches[0];t=s.pageX-a,n=s.pageY-u}else t=e.pageX-a,n=e.pageY-u;return{x:t,y:n}}function h(e){var t=e.currentTarget;if(!t)return[];for(var n=[],o=t.getBoundingClientRect(),r=o.left+window.pageXOffset,i=o.top+window.pageYOffset,a=0;a<e.touches.length;a++){var u=e.touches[a];n.push({x:u.pageX-r,y:u.pageY-i})}return n}function w(t,n){void 0===n&&(n=function(){});var o=!1,r=null,i=null,a=null,u=0;return{onDown:function(t){o=!0,r=s(t),a=(0,e.__assign)({},r),i=(0,e.__assign)({},r),u=Date.now()},onMove:function(n){o&&(n.preventDefault(),a=s(n),o&&r&&a&&i&&(t({base:r,p:(0,e.__assign)({},a),d:{x:a.x-i.x,y:a.y-i.y}}),i=(0,e.__assign)({},a)))},onUp:function(){a&&Date.now()-u<100&&n((0,e.__assign)({},a)),o=!1,r=null,a=null,i=null,u=0}}}function d(e){var t="ontouchstart"in window;return e.onDown&&(window.addEventListener("mousedown",e.onDown,!1),t&&window.addEventListener("touchstart",e.onDown,!1)),e.onMove&&(window.addEventListener("mousemove",e.onMove,!1),t&&window.addEventListener("touchmove",e.onMove,{capture:!1,passive:!1})),e.onUp&&(window.addEventListener("mouseup",e.onUp,!1),window.addEventListener("mouseleave",e.onUp,!1),t&&(window.addEventListener("touchend",e.onUp,!1),window.addEventListener("touchcancel",e.onUp,!1))),function(){e.onDown&&(window.removeEventListener("mousedown",e.onDown,!1),t&&window.removeEventListener("touchstart",e.onDown,!1)),e.onMove&&(window.removeEventListener("mousemove",e.onMove,!1),t&&window.removeEventListener("touchmove",e.onMove,{capture:!1})),e.onUp&&(window.removeEventListener("mouseup",e.onUp,!1),window.removeEventListener("mouseleave",e.onUp,!1),t&&(window.removeEventListener("touchend",e.onUp,!1),window.removeEventListener("touchcancel",e.onUp,!1)))}}function g(e){return new Promise(function(t,n){var o=new FileReader;o.onload=function(){return t(o.result)},o.onerror=n,o.readAsDataURL(e)})}function v(e){return new Promise(function(t,n){var o=new Image;o.onload=function(){return t(o)},o.onerror=n,o.src=e})}function f(t){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return t instanceof Image?[2,t]:[4,v(t)];case 1:return[2,e.sent()]}})})}function l(t,n,o){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,a,u;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return r=null!=o?o:{width:n.width,height:n.height},[4,f(t)];case 1:if(i=e.sent(),(a=document.createElement("canvas")).width=r.width,a.height=r.height,!(u=a.getContext("2d")))throw new Error("Failed to get 2d-context from a canvas.");return u.drawImage(i,n.x,n.y,n.width,n.height,0,0,a.width,a.height),[2,a]}})})}function p(t,n,o){return(0,e.__awaiter)(this,void 0,void 0,function(){return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,l(t,n,o)];case 1:return[2,e.sent().toDataURL()]}})})}function m(t,n,o){return(0,e.__awaiter)(this,void 0,void 0,function(){var r;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,l(t,n,o)];case 1:return r=e.sent(),[2,new Promise(function(e,t){r.toBlob(function(n){n&&e(n),t(new Error("Failed to create blob."))},"image/png")})]}})})}function x(t,n,o){return(0,e.__awaiter)(this,void 0,void 0,function(){var r,i,a;return(0,e.__generator)(this,function(e){switch(e.label){case 0:return[4,f(t)];case 1:if(r=e.sent(),(i=document.createElement("canvas")).width=r.width,i.height=r.height,!(a=i.getContext("2d")))throw new Error("Failed to get 2d-context from a canvas.");return a.drawImage(r,0,0,r.width,r.height),o?o(a):(a.strokeStyle="red",a.lineWidth=3),a.strokeRect(n.x,n.y,n.width,n.height),[2,i.toDataURL()]}})})}
},{"tslib":"vCxL"}],"SGr5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getResetStyles=o,exports.appendChildren=i,exports.createHTMLElement=a,exports.createSVGElement=l,exports.createElement=s,exports.setStyles=u,exports.createClipRectElm=c,exports.createSvgWrapperElm=d,exports.createSvg=p,exports.createPhotoSVG=g,exports.createDeleteSVG=x,exports.createOverflowSVG=L,exports.show=m,exports.hide=w,exports.setAttribute=exports.appendChild=exports.getElementById=void 0;var t="http://www.w3.org/2000/svg",e=function(t){return document.getElementById(t)};exports.getElementById=e;var r=function(t,e){return t.appendChild(e)};exports.appendChild=r;var n=function(t,e,r){return t.setAttribute(e,r)};function o(){return{padding:"0",margin:"0",border:"none","background-color":"transparent"}}function i(t,e){var n=document.createDocumentFragment();return e.forEach(function(t){return r(n,t)}),r(t,n),t}function a(t,e,r){return void 0===e&&(e=null),void 0===r&&(r=[]),s(document.createElement(t),e,r)}function l(e,r,n){return void 0===r&&(r=null),void 0===n&&(n=[]),s(document.createElementNS(t,e),r,n)}function s(t,e,r){for(var o in void 0===e&&(e=null),void 0===r&&(r=[]),e){var i=e[o];"function"==typeof i?t[o]=i:n(t,o,e[o].toString())}if(Array.isArray(r)){for(var a=document.createDocumentFragment(),l=0;l<r.length;l++)a.appendChild(r[l]);t.appendChild(a)}else t.textContent=r;return t}function u(t,e){t&&t.setAttribute("style",Object.keys(e).map(function(t){return t+":"+e[t]+";"}).join(""))}function c(t,e,r){var n=l("g",null,[f(e,r.onStartMove)]),o=l("g",{transform:"translate("+t.width+", "+t.height+")"},[h(e,r.onStartResize)]);return l("g",{transform:"translate("+t.x+", "+t.y+")"},[l("rect",{x:0,y:0,width:t.width,height:t.height,fill:"none",stroke:"red","stroke-width":3*e}),n,o])}function d(t){var e=a("div");return u(e,{padding:"8px",border:"3px solid #aaa","border-radius":"8px","background-color":"#f4f4f4",overflow:"hidden",position:"relative",width:t.width+"px",height:t.height+"px"}),e}function p(){var t=l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"});return u(t,{overflow:"visible",width:"100%",height:"100%"}),t}function f(t,e){return l("g",{onmousedown:e,ontouchstart:e,transform:"scale("+t+")",stroke:"none",style:"cursor:pointer"},[l("circle",{r:8,fill:"red"}),l("path",{d:"M-6-2L-6 2L6 2L6-2zM-2-6L-2 6L2 6L2-6z",fill:"#fff"})])}function h(t,e){return l("g",{onmousedown:e,ontouchstart:e,transform:"scale("+t+") rotate(45)",stroke:"none",style:"cursor:pointer"},[l("circle",{r:8,fill:"red"}),l("path",{d:"M-2-2-2-5L-7 0L-2 5L-2 2L2 2L2 5L7 0L2-5L2-2z",fill:"#fff"})])}function g(){return i(p(),[l("g",{transform:"translate(25,25)"},[l("rect",{width:"50",height:"50",rx:"4",ry:"4",fill:"none",stroke:"#aaa","stroke-width":"2"}),l("g",{fill:"#aaa"},[l("path",{d:"M0 45L0 40L15 25L20 30L30 20L50 40L50 45z"}),l("circle",{cx:"10",cy:"15",r:"4"})])])])}function v(t){return void 0===t&&(t="#aaa"),l("circle",{cx:50,cy:50,r:50,fill:"none",stroke:t,"stroke-width":10})}function x(){return i(p(),[l("g",null,[v(),l("path",{d:"M24 24L76 76M24 76L76,24",fill:"none",stroke:"#aaa","stroke-width":12})])])}function L(t){void 0===t&&(t=!1);var e=t?"limegreen":"#aaa";return i(p(),[l("g",null,[v(e),l("path",{d:"M40 6L40 80L14 80",fill:"none",stroke:e,"stroke-width":8}),l("path",{d:"M90 50L60 80L60 58L20 58L20 42L60 42L60 20z",fill:e,stroke:"none"})])])}function m(t,e){return t&&(t.style.display=null!=e?e:""),t}function w(t){return t&&(t.style.display="none"),t}exports.setAttribute=n;
},{}],"fUdq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClipFlappers=exports.base64ToImage=exports.clipImage=void 0;var e=require("okanvas"),t=require("./el"),i=function(){return(i=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},r=function(e,t,i,r){return new(i||(i=Promise))(function(n,o){function s(e){try{a(r.next(e))}catch(t){o(t)}}function l(e){try{a(r.throw(e))}catch(t){o(t)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,l)}a((r=r.apply(e,t||[])).next())})},n=function(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(l){o=[6,l],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},o=e.clipImage;exports.clipImage=o;var s=e.base64ToImage;exports.base64ToImage=s;var l="clip-f",a=function(){function a(e,r){var n=this;if(this.$svg=null,this.$clipRect=null,this.base64="",this.image=null,this.errorMessages={invalidImageFile:"Invalid image file."},this.errorTimer=0,this.viewSize={width:124,height:124},this.clipSize={width:124,height:124},this.disposeWindowPointer=function(){},this.dragMode="",this.clipRect=null,this.clipRectOrg=null,this.dragListeners=null,this.onUpdateClip=null,this.overflow=!1,this.onUp=function(){n.dragListeners&&(n.dragListeners.onUp(),n.clipRectOrg&&n.onCompleteClip(),n.dragMode="",n.clipRectOrg=null)},this.onStartMove=function(e){n.clipRect&&n.dragListeners&&(n.dragMode="move",n.clipRectOrg=i({},n.clipRect),n.dragListeners.onDown(e))},this.onStartResize=function(e){n.clipRect&&n.dragListeners&&(n.dragMode="resize",n.clipRectOrg=i({},n.clipRect),n.dragListeners.onDown(e))},e instanceof Element)this.$el=e;else{var o=(0,t.getElementById)(e);if(!(o instanceof Element))throw new Error("Failed to mount target: "+e);this.$el=o}(null==r?void 0:r.errorMessages)&&(this.errorMessages=r.errorMessages),(null==r?void 0:r.viewSize)&&(this.viewSize=r.viewSize),(null==r?void 0:r.clipSize)&&(this.clipSize=r.clipSize),(null==r?void 0:r.onUpdateClip)&&(this.onUpdateClip=r.onUpdateClip),(null==r?void 0:r.overflow)&&(this.overflow=r.overflow),this.render()}return a.prototype.dispose=function(){this.$el.innerHTML="",this.$el=null,this.$svg=null,this.$clipRect=null,this.image=null,this.disposeWindowPointer(),this.dragListeners=null},a.prototype.reset=function(){this.$clipRect=null,this.image=null,this.disposeWindowPointer(),this.dragListeners=null,this.$svg.innerHTML="",(0,t.hide)(this.$svg),(0,t.show)(this.getElement("drop")),(0,t.hide)(this.getElement("delete")),(0,t.hide)(this.getElement("overflow"))},a.prototype.toggleOverflow=function(){this.overflow=!this.overflow,this.clipRect&&this.updateClipRect(this.clipRect);var e=this.getElement("overflow");e&&(e.innerHTML="",(0,t.appendChild)(e,(0,t.createOverflowSVG)(this.overflow)))},a.prototype.clip=function(){return r(this,void 0,Promise,function(){return n(this,function(e){if(!this.image||!this.clipRect)throw new Error("image not loaded");return[2,o(this.image,this.clipRect,this.clipSize)]})})},a.prototype.getElement=function(e){return this.$el.querySelector('[data-key="'+l+"_"+e+'"]')},a.prototype.render=function(){var e=this,r=(0,t.createHTMLElement)("input",{type:"file",accept:"image/*",oninput:function(t){return e.onInputFile(t)}});(0,t.hide)(r);var n=(0,t.createHTMLElement)("button",i({onclick:function(){return r.click()}},c("drop")),[(0,t.createPhotoSVG)()]);(0,t.setStyles)(n,i(i({},(0,t.getResetStyles)()),{width:"100%",height:"100%",cursor:"pointer"}));var o=(0,t.createHTMLElement)("button",i({onclick:function(){return e.reset()}},c("delete")),[(0,t.createDeleteSVG)()]);(0,t.setStyles)(o,i(i({},(0,t.getResetStyles)()),{position:"absolute",top:"4px",right:"4px",width:"20px",height:"20px","border-radius":"100%",cursor:"pointer"})),(0,t.hide)(o);var s=(0,t.createHTMLElement)("button",i({onclick:function(){return e.toggleOverflow()}},c("overflow")),[(0,t.createOverflowSVG)(this.overflow)]);(0,t.setStyles)(s,i(i({},(0,t.getResetStyles)()),{position:"absolute",top:"28px",right:"4px",width:"20px",height:"20px","border-radius":"100%",cursor:"pointer"})),(0,t.hide)(s);var l=(0,t.createHTMLElement)("p",i(i({},c("error")),{onclick:function(){return e.hideError()}}));(0,t.setStyles)(l,i(i({},(0,t.getResetStyles)()),{position:"absolute",bottom:"0",left:"0",right:"0",padding:"4px 8px",color:"white","background-color":"red","font-size":"16px","word-break":"break-all",cursor:"pointer",transition:"0.5s all",transform:"translateY(100%)"}));var a=(0,t.createSvgWrapperElm)(this.viewSize);a.ondragover=function(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),a.style.opacity="0.7"},a.ondragleave=function(e){e.preventDefault(),a.style.opacity=""},a.ondrop=function(t){t.preventDefault(),a.style.opacity="",e.onInputFile(t)},this.$svg=(0,t.createSvg)(),(0,t.hide)(this.$svg),(0,t.appendChildren)(this.$el,[(0,t.appendChildren)((0,t.createHTMLElement)("div",null,[]),[r,(0,t.appendChildren)(a,[this.$svg,n,o,s,l])])])},a.prototype.updateImage=function(o){return r(this,void 0,void 0,function(){var r,l,a,h,c,p=this;return n(this,function(n){switch(n.label){case 0:r=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s(o)];case 2:return r=n.sent(),[3,4];case 3:return n.sent(),this.setErrorMessage("invalidImageFile"),[3,4];case 4:return r?(this.base64=o,this.image=r,l=(0,e.getCentralizedViewBox)(this.clipSize,r),(a=this.$svg).innerHTML="",(0,t.show)(a),(0,t.setAttribute)(a,"viewBox",l.x+" "+l.y+" "+l.width+" "+l.height),(0,t.hide)(this.getElement("drop")),(0,t.show)(this.getElement("delete")),(0,t.show)(this.getElement("overflow")),h=(0,e.getRate)(this.viewSize,(0,e.getCentralizedViewBox)(this.clipSize,r)).maxRate,c=(0,e.useDrag)(function(e){return p.onDrag(e,h)}),this.dragListeners=c,this.disposeWindowPointer(),this.disposeWindowPointer=(0,e.useWindowPointerEffect)({onMove:c.onMove,onUp:this.onUp}),this.clipRect=this.overflow?i({},l):u(l,{x:0,y:0,width:r.width,height:r.height},!0),this.$clipRect=(0,t.createClipRectElm)(this.clipRect,h,{onStartMove:this.onStartMove,onStartResize:this.onStartResize}),(0,t.appendChildren)(a,[(0,t.createSVGElement)("image",{x:0,y:0,width:r.width,height:r.height,href:this.base64}),this.$clipRect]),[2]):[2]}})})},a.prototype.updateClipRect=function(i){if(this.$svg&&this.$clipRect&&this.image&&this.clipRect){var r=this.overflow?i:u(i,{x:0,y:0,width:this.image.width,height:this.image.height});if(!p(this.clipRect,r)){this.clipRect=r;var n=(0,e.getRate)(this.viewSize,(0,e.getCentralizedViewBox)(this.clipSize,this.image)).maxRate,o=(0,t.createClipRectElm)(this.clipRect,n,{onStartMove:this.onStartMove,onStartResize:this.onStartResize});this.$svg.removeChild(this.$clipRect),(0,t.appendChild)(this.$svg,o),this.$clipRect=o}}},a.prototype.onCompleteClip=function(){return r(this,void 0,void 0,function(){return n(this,function(e){return this.image&&this.clipRect?(this.onUpdateClip&&this.onUpdateClip(this.base64,this.clipRect,this.clipSize),[2]):[2]})})},a.prototype.onDrag=function(e,t){var r=this.dragMode,n=this.clipRectOrg,o=this.clipSize;if(r&&n)if("move"===r)this.updateClipRect(i(i({},n),{x:n.x+(e.p.x-e.base.x)*t,y:n.y+(e.p.y-e.base.y)*t}));else if("resize"===r){var s=h({x:n.width+(e.p.x-e.base.x)*t,y:n.height+(e.p.y-e.base.y)*t},{x:0,y:0},{x:o.width,y:o.height});this.updateClipRect(i(i({},n),{width:s.x,height:s.y}))}},a.prototype.onInputFile=function(t){var i,o,s;return r(this,void 0,void 0,function(){var r,l;return n(this,function(n){switch(n.label){case 0:if(!(r=null!==(o=null===(i=null==t?void 0:t.target)||void 0===i?void 0:i.files)&&void 0!==o?o:null===(s=t.dataTransfer)||void 0===s?void 0:s.files))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(0,e.fileToBase64)(r[0])];case 2:return l=n.sent(),this.updateImage(l),[3,4];case 3:return n.sent(),this.setErrorMessage("invalidImageFile"),[3,4];case 4:return[2]}})})},a.prototype.setErrorMessage=function(e){var t=this,i=this.getElement("error");i&&(i.textContent=this.errorMessages[e],i.style.transform="",clearTimeout(this.errorTimer),this.errorTimer=setTimeout(function(){return t.hideError()},5e3))},a.prototype.hideError=function(){var e=this.getElement("error");e&&(e.style.transform="translateY(100%)",clearTimeout(this.errorTimer),this.errorTimer=0)},a}();function h(e,t,i){var r=i,n=e.x-t.x,o=e.y-t.y,s=r.x*r.x+r.y*r.y,l=(r.x*n+r.y*o)/s;return{x:r.x*l,y:r.y*l}}function c(e){return{"data-key":l+"_"+e}}function p(e,t){return!!e&&!!t&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function u(t,i,r){void 0===r&&(r=!1);var n=Math.min((0,e.getRate)(t,i).minRate,1),o=t.width*n,s=t.height*n;return r?{x:i.x+(i.width-o)/2,y:i.y+(i.height-s)/2,width:o,height:s}:{x:d(t.x,i.x,i.x+i.width-o),y:d(t.y,i.y,i.y+i.height-s),width:o,height:s}}function d(e,t,i){return Math.min(i,Math.max(e,t))}exports.ClipFlappers=a;
},{"okanvas":"qDjK","./el":"SGr5"}],"QCba":[function(require,module,exports) {
"use strict";var n,e,t,r=require("../src/index"),i=function(n,e,t,r){return new(t||(t=Promise))(function(i,o){function l(n){try{c(r.next(n))}catch(e){o(e)}}function u(n){try{c(r.throw(n))}catch(e){o(e)}}function c(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t(function(n){n(e)})).then(l,u)}c((r=r.apply(n,e||[])).next())})},o=function(n,e){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=(i=l.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(n,l)}catch(u){o=[6,u],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},l=null;function u(n){return i(this,void 0,void 0,function(){var e;return o(this,function(t){return(e=new Image).onload=function(){e.style.border="solid 1px black",e.style.margin="2px";var n=document.getElementById("clipped");n.innerHTML="",n.appendChild(e)},e.src=n,[2]})})}function c(n,e,t){return i(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,(0,r.clipImage)(n,e,t)];case 1:return u(i.sent()),[2]}})})}function a(){l=new r.ClipFlappers("target",{viewSize:{width:300,height:200},onUpdateClip:c,overflow:!0})}null===(n=document.getElementById("init"))||void 0===n||n.addEventListener("click",function(){null==l||l.dispose(),a()}),null===(e=document.getElementById("dispose"))||void 0===e||e.addEventListener("click",function(){l&&(l.dispose(),l=null)}),null===(t=document.getElementById("clip"))||void 0===t||t.addEventListener("click",function(){return i(void 0,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return l?[4,l.clip()]:[2];case 1:return u(n.sent()),[2]}})})}),a();
},{"../src/index":"fUdq"}]},{},["QCba"], null)
//# sourceMappingURL=demo.b579ce5d.js.map